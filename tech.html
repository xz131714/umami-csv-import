<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>技术说明 - Umami CSV工具</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      margin: 0;
      padding: 20px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
    }

    .container {
      max-width: 900px;
      margin: 0 auto;
      background: white;
      border-radius: 15px;
      padding: 40px;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
    }

    .header {
      text-align: center;
      margin-bottom: 40px;
      border-bottom: 2px solid #f0f0f0;
      padding-bottom: 20px;
    }

    .header h1 {
      color: #2c3e50;
      margin: 0;
      font-size: 2.2em;
    }

    .header p {
      color: #666;
      margin: 10px 0 0 0;
    }

    .section {
      margin: 30px 0;
      padding: 25px;
      background: #f8f9fa;
      border-radius: 10px;
      border-left: 4px solid #3498db;
    }

    .section h3 {
      color: #2c3e50;
      margin-top: 0;
      margin-bottom: 20px;
    }

    .workflow {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin: 20px 0;
    }

    .workflow-step {
      background: white;
      padding: 20px;
      border-radius: 8px;
      text-align: center;
      border: 2px solid #e1e5e9;
      transition: all 0.3s ease;
    }

    .workflow-step:hover {
      border-color: #3498db;
      transform: translateY(-5px);
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
    }

    .workflow-step .step-number {
      background: #3498db;
      color: white;
      width: 30px;
      height: 30px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 15px auto;
      font-weight: bold;
    }

    .workflow-step h4 {
      color: #2c3e50;
      margin: 10px 0;
    }

    .workflow-step p {
      color: #666;
      font-size: 0.9em;
      margin: 0;
    }

    .comparison {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin: 20px 0;
    }

    .comparison-card {
      padding: 20px;
      border-radius: 8px;
      text-align: center;
    }

    .comparison-card.good {
      background: #d4edda;
      border: 2px solid #c3e6cb;
    }

    .comparison-card.bad {
      background: #f8d7da;
      border: 2px solid #f5c6cb;
    }

    .comparison-card h4 {
      margin-top: 0;
    }

    .comparison-card.good h4 {
      color: #155724;
    }

    .comparison-card.bad h4 {
      color: #721c24;
    }

    .tech-stack {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 15px;
      margin: 20px 0;
    }

    .tech-item {
      background: white;
      padding: 15px;
      border-radius: 6px;
      border-left: 4px solid #27ae60;
    }

    .tech-item h5 {
      color: #2c3e50;
      margin: 0 0 8px 0;
    }

    .tech-item p {
      color: #666;
      margin: 0;
      font-size: 0.9em;
    }

    .alert {
      padding: 20px;
      border-radius: 8px;
      margin: 20px 0;
      border-left: 4px solid;
    }

    .alert-warning {
      background: #fff3cd;
      border-color: #f0ad4e;
      color: #856404;
    }

    .alert-info {
      background: #d1ecf1;
      border-color: #17a2b8;
      color: #0c5460;
    }

    .alert-success {
      background: #d4edda;
      border-color: #28a745;
      color: #155724;
    }

    .code-example {
      background: #2c3e50;
      color: #ecf0f1;
      padding: 20px;
      border-radius: 6px;
      font-family: 'Courier New', monospace;
      overflow-x: auto;
      margin: 15px 0;
      font-size: 14px;
    }

    .back-links {
      text-align: center;
      margin-top: 40px;
      padding-top: 20px;
      border-top: 1px solid #ecf0f1;
    }

    .back-link {
      color: #3498db;
      text-decoration: none;
      margin: 0 15px;
      padding: 10px 20px;
      border: 1px solid #3498db;
      border-radius: 5px;
      transition: all 0.3s;
    }

    .back-link:hover {
      background: #3498db;
      color: white;
    }
  </style>
</head>

<body>
  <div class="container">
    <div class="header">
      <h1>🔧 技术架构说明</h1>
      <p>深入了解Umami CSV工具的技术实现和工作原理</p>
    </div>

    <div class="alert alert-warning">
      <strong>⚠️ 核心概念:</strong>
      本工具采用"前端生成，本地执行"的架构模式。Cloudflare Pages 负责托管静态网页，Python脚本在用户本地计算机执行。
    </div>

    <!-- 架构概述 -->
    <div class="section">
      <h3>🏗️ 架构概述</h3>
      <div class="comparison">
        <div class="comparison-card good">
          <h4>✅ 我们的方案</h4>
          <p><strong>前端:</strong> Cloudflare Pages (静态)</p>
          <p><strong>后端:</strong> 用户本地Python环境</p>
          <p><strong>数据:</strong> 本地处理，安全可控</p>
          <p><strong>成本:</strong> 完全免费</p>
        </div>
        <div class="comparison-card bad">
          <h4>❌ 传统方案</h4>
          <p><strong>前端:</strong> 需要服务器</p>
          <p><strong>后端:</strong> 云端Python/Node.js</p>
          <p><strong>数据:</strong> 上传到云端处理</p>
          <p><strong>成本:</strong> 需要付费服务器</p>
        </div>
      </div>
    </div>

    <!-- 工作流程 -->
    <div class="section">
      <h3>🔄 详细工作流程</h3>
      <div class="workflow">
        <div class="workflow-step">
          <div class="step-number">1</div>
          <h4>在线配置</h4>
          <p>用户在Cloudflare Pages上填写数据库配置和上传CSV文件</p>
        </div>
        <div class="workflow-step">
          <div class="step-number">2</div>
          <h4>脚本生成</h4>
          <p>JavaScript在浏览器中根据配置生成完整的Python脚本</p>
        </div>
        <div class="workflow-step">
          <div class="step-number">3</div>
          <h4>本地下载</h4>
          <p>用户将生成的Python脚本下载到本地计算机</p>
        </div>
        <div class="workflow-step">
          <div class="step-number">4</div>
          <h4>本地执行</h4>
          <p>在本地Python环境中运行脚本，直接连接数据库导入数据</p>
        </div>
      </div>
    </div>

    <!-- 技术栈 -->
    <div class="section">
      <h3>💻 技术栈详解</h3>
      <div class="tech-stack">
        <div class="tech-item">
          <h5>Cloudflare Pages</h5>
          <p>全球CDN，静态网站托管，免费SSL证书，自动部署</p>
        </div>
        <div class="tech-item">
          <h5>HTML5 + CSS3</h5>
          <p>响应式设计，现代化界面，无需额外框架</p>
        </div>
        <div class="tech-item">
          <h5>原生JavaScript</h5>
          <p>文件处理，表单验证，脚本生成，无依赖</p>
        </div>
        <div class="tech-item">
          <h5>Python生态</h5>
          <p>pandas, numpy, pymysql, psycopg2数据处理库</p>
        </div>
      </div>
    </div>

    <!-- 为什么不能在Cloudflare上运行Python -->
    <div class="section">
      <h3>❓ 为什么不能在Cloudflare上运行Python？</h3>

      <div class="alert alert-info">
        <strong>Cloudflare Pages的限制:</strong>
        <ul>
          <li>🚫 只支持静态文件托管 (HTML, CSS, JS, 图片等)</li>
          <li>🚫 不支持服务端脚本 (Python, PHP, Node.js等)</li>
          <li>🚫 不能安装Python包或运行pip install</li>
          <li>🚫 没有文件系统写入权限</li>
          <li>🚫 不能直接连接外部数据库</li>
        </ul>
      </div>

      <div class="alert alert-success">
        <strong>Cloudflare Workers的可能性:</strong>
        <p>虽然Cloudflare Workers支持JavaScript运行时，但处理大型CSV文件和数据库连接仍有限制。我们的方案更加灵活可靠。</p>
      </div>
    </div>

    <!-- 代码示例 -->
    <div class="section">
      <h3>📝 核心代码原理</h3>
      <p>以下是JavaScript生成Python脚本的核心代码示例：</p>

      <div class="code-example">
        // JavaScript 在浏览器中生成 Python 脚本
        function generatePythonScript(config) {
        const pythonCode = `
        # 自动生成的 Umami 导入脚本
        import pandas as pd
        import ${config.db_type === 'mysql' ? 'pymysql' : 'psycopg2'} as db

        # 数据库配置 (用户输入)
        DB_CONFIG = {
        'host': '${config.host}',
        'port': ${config.port},
        'user': '${config.username}',
        'password': '${config.password}',
        'database': '${config.database}'
        }

        # 读取CSV文件
        df = pd.read_csv('${config.csv_file}')

        # 数据处理和导入逻辑...
        `;

        // 创建下载链接
        const blob = new Blob([pythonCode], {type: 'text/plain'});
        const url = URL.createObjectURL(blob);
        // 用户下载脚本到本地
        }
      </div>
    </div>

    <!-- 优势和劣势 -->
    <div class="section">
      <h3>⚖️ 方案优劣分析</h3>

      <h4 style="color: #27ae60;">✅ 优势</h4>
      <ul>
        <li><strong>完全免费:</strong> 无需付费服务器或云函数</li>
        <li><strong>数据安全:</strong> CSV文件和数据库密码不会上传到云端</li>
        <li><strong>性能优秀:</strong> 本地处理速度快，无网络延迟</li>
        <li><strong>灵活性强:</strong> 可以处理任意大小的CSV文件</li>
        <li><strong>易于维护:</strong> 纯静态站点，稳定可靠</li>
      </ul>

      <h4 style="color: #e74c3c;">⚠️ 限制</h4>
      <ul>
        <li><strong>需要本地环境:</strong> 用户需要安装Python环境</li>
        <li><strong>技术门槛:</strong> 需要基本的命令行操作知识</li>
        <li><strong>网络要求:</strong> 本地需要能连接到数据库服务器</li>
        <li><strong>非实时处理:</strong> 需要下载脚本后执行</li>
      </ul>
    </div>

    <!-- 替代方案对比 -->
    <div class="section">
      <h3>🔄 其他可能的方案</h3>

      <div style="margin: 15px 0;">
        <h4>方案1: Vercel + Python API</h4>
        <p>❌ <strong>问题:</strong> 需要付费计划，冷启动延迟，文件大小限制</p>
      </div>

      <div style="margin: 15px 0;">
        <h4>方案2: Cloudflare Workers</h4>
        <p>❌ <strong>问题:</strong> 只支持JavaScript，CPU时间限制，内存限制</p>
      </div>

      <div style="margin: 15px 0;">
        <h4>方案3: 传统VPS</h4>
        <p>❌ <strong>问题:</strong> 需要月付费用，运维复杂，安全风险</p>
      </div>

      <div style="margin: 15px 0;">
        <h4>方案4: 我们的方案</h4>
        <p>✅ <strong>优势:</strong> 免费、安全、灵活、性能好</p>
      </div>
    </div>

    <!-- 使用建议 -->
    <div class="section">
      <h3>💡 使用建议</h3>

      <div class="alert alert-success">
        <strong>推荐用户类型:</strong>
        <ul>
          <li>🎯 有基本Python知识的开发者</li>
          <li>🎯 需要处理敏感数据的企业用户</li>
          <li>🎯 希望完全控制数据处理流程的用户</li>
          <li>🎯 需要处理大型CSV文件的用户</li>
        </ul>
      </div>
    </div>

    <!-- 返回链接 -->
    <div class="back-links">
      <a href="/index.html" class="back-link">🏠 返回首页</a>
      <a href="/main.html" class="back-link">🚀 主功能</a>
      <a href="/advanced.html" class="back-link">🔧 高级配置</a>
    </div>
  </div>
</body>

</html>